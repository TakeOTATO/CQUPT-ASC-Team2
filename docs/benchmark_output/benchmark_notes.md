# Benchmark Notes: HPL与HPCG基准测试分析

## 第一部分：HPL (High-Performance Linpack)

### 目标

HPL（高性能Linpack基准测试）是用于测试高性能计算（HPC）集群系统浮点计算能力的核心程序。其主要目的是通过高斯消元法求解大规模稠密线性代数方程组，以此来评估集群的持续浮点计算性能，即实测浮点峰值。

### 输出

HPL运行后会在终端或输出文件中生成详细的性能报告。一个典型的输出示例如下：

```
================================================================================
T/V  N    NB  P  Q  Time      Gflops
WC00C2R100000  176640  256  2  2  973.53  3.77426e+03
================================================================================
```

输出行中各列的含义为：

· T/V：测试类型标识。
· N：线性方程组的大小（矩阵维数）。
· NB：分块大小。
· P, Q：MPI进程网格的维度（P×Q等于总进程数）。
· Time：求解方程组所花费的时间（单位：秒）。
· Gflops：实测的浮点计算性能，单位为每秒十亿次浮点运算（Giga-FLOPS）。

### 性能指标

· 核心指标：Gflops。这是HPL最关键的输出，直接反映了系统在求解稠密线性方程组时的持续浮点计算性能。
· 派生指标：
  · 效率：实测性能（Gflops）与系统理论浮点峰值（由CPU主频、核心数等计算得出）的比值，用于衡量硬件利用率和优化水平。
  · 可扩展性：通过调整进程数（P, Q）和问题规模（N）来观察Gflops的变化，从而评估系统在不同规模下的并行扩展能力。

## 第二部分：HPCG (High-Performance Conjugate Gradient)

### 目标

HPCG（高性能共轭梯度基准测试）旨在作为HPL的补充，提供一个更贴近实际科学计算应用的性能衡量标准。它通过求解一个由3D规则网格上27点模板生成的大型稀疏线性系统，来评估HPC系统在计算、内存访问（带宽）、以及通信等方面的综合性能，更能反映真实应用（如计算流体动力学、结构分析）的负载特征。

### 输出

HPCG的最终结果文件会给出详细的性能分析。其中 Final Summary::HPCG result is VALID with a GFLOP/s rating of= 之后的数值是官方认可的性能评分。此外，文件还会提供一个‘HPCG 2.4 rating’也就是历史版本的性能评分。
### 性能指标

· 核心指标：Performance (GFLOPS)。与HPL不同，HPCG的GFLOPS值通常远低于系统的理论峰值，因为它受到内存带宽和通信延迟的严重制约。这个数值反映了系统处理稀疏、不规则访问模式计算任务的实际能力。
· 关键内核性能：HPCG的性能依赖于其内部关键操作（Kernel）的效率。其中，多重网格（MG）预条件子是最耗时的部分，通常占据总计算时间的80%以上；稀疏矩阵-向量乘法（SpMV） 次之。优化这些内核是提升整体分数的关键。
· 内存带宽利用率：HPCG是一个典型的内存带宽受限型测试。其性能与系统的实际可持续内存带宽强相关，因此常被用作评估系统内存子系统压力的有效工具。

## 第三部分：在超算竞赛中的作用与意义

在ASC世界大学生超级计算机竞赛等顶级赛事中，HPL与HPCG是必考的核心基准测试项目，它们共同构成了评估参赛队伍超算系统综合能力的“铁人两项”。

1. 角色定位的差异：
   · HPL (直线加速赛)：如同赛车在直线跑道上比拼绝对速度，HPL主要考察集群的极限浮点计算能力。优化HPL旨在尽可能榨干CPU/GPU的每秒浮点运算潜力，考验的是对计算密集型任务的极致优化。
   · HPCG (复杂路况赛)：如同赛车在复杂多弯的城市路段中行驶，HPCG考察的是系统在计算、访存、通信等多维度压力下的均衡性能。它考验的是团队对内存层次结构、数据局部性、通信开销等复杂因素的综合调优能力。
2. 在竞赛中的综合意义：
   · 全面评估系统：单独的高HPL分数可能意味着强大的计算芯片，但低的HPCG分数则表明系统在处理真实科学计算问题时可能存在瓶颈（如“内存墙”）。两者结合才能全面评价一个超算系统的优劣。
   · 引导优化方向：赛事要求参赛队在严格的功耗限制下取得最佳成绩，这迫使队伍不能只追求硬件堆砌。必须在软硬件协同优化上做出战略抉择：是优先保证HPL的峰值算力，还是优化内存子系统以提升HPCG成绩，这体现了深刻的工程权衡智慧。
   · 连接理论与应用：HPL代表了对理想化、规则计算任务的性能上限，而HPCG则桥梁性地指向了实际应用中的性能表现。在竞赛中同时优化二者，有助于培养学生从理解硬件理论峰值到解决实际工程问题的完整能力链条。

## 总结

HPL和HPCG是现代超算性能评估中不可或缺的一体两面。HPL揭示了系统的“爆发力”，即理论计算潜力的实现程度；而HPCG则揭示了系统的“耐力”与“综合素质”，即应对复杂真实负载的稳健性。在超算竞赛中，成功平衡并优化这两项测试，是衡量一支队伍是否具备构建高效、实用高性能计算系统能力的关键标尺。
